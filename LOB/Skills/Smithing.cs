//bronze
$lob::barsNeeded["BronzeShortSwordItem"] = "Bronze";
$lob::barsAmountNeeded["BronzeShortSwordItem"] = 4;
$lob::smithingLevelNeeded["BronzeShortSwordItem"] = 0;
$lob::smithingAnimationTime["BronzeShortSwordItem"] = 5000;
$lob::chatMessageName["BronzeShortSwordItem"] = "Bronze Short Sword";
$lob::smithingExp["BronzeShortSwordItem"] = 100;

$lob::barsNeeded["BronzepickAxeItem"] = "Bronze";
$lob::barsAmountNeeded["BronzepickAxeItem"] = 2;
$lob::smithingLevelNeeded["BronzepickAxeItem"] = 0;
$lob::smithingAnimationTime["BronzepickAxeItem"] = 3000;
$lob::chatMessageName["BronzepickAxeItem"] = "Bronze Pickaxe";
$lob::smithingExp["BronzePickaxeItem"] = 80;

$lob::barsNeeded["BronzeAxeItem"] = "Bronze";
$lob::barsAmountNeeded["BronzeAxeItem"] = 2;
$lob::smithingLevelNeeded["BronzeAxeItem"] = 0;
$lob::smithingAnimationTime["BronzeAxeItem"] = 3000;
$lob::chatMessageName["BronzeAxeItem"] = "Bronze Axe";
$lob::smithingExp["BronzeAxeItem"] = 80;

$lob::barsNeeded["BronzeBowItem"] = "Bronze";
$lob::barsAmountNeeded["BronzeBowItem"] = 5;
$lob::smithingLevelNeeded["BronzeBowItem"] = 0;
$lob::smithingAnimationTime["BronzeBowItem"] = 3000;
$lob::chatMessageName["BronzeBowItem"] = "Bronze Bow";
$lob::smithingExp["BronzeBowItem"] = 150;

$lob::barsNeeded["BronzeJavlinItem"] = "Bronze";
$lob::barsAmountNeeded["BronzeJavlinItem"] = 9;
$lob::smithingLevelNeeded["BronzeJavlinItem"] = 0;
$lob::smithingAnimationTime["BronzeJavlinItem"] = 3000;
$lob::chatMessageName["BronzeJavlinItem"] = "Bronze Javlin";
$lob::smithingExp["BronzeJavlinItem"] = 200;

//iron
$lob::barsNeeded["IronShortSwordItem"] = "Iron";
$lob::barsAmountNeeded["IronShortSwordItem"] = 4;
$lob::smithingLevelNeeded["IronShortSwordItem"] = 10;
$lob::smithingAnimationTime["IronShortSwordItem"] = 8000;
$lob::chatMessageName["IronShortSwordItem"] = "Iron Short Sword";
$lob::smithingExp["IronShortSwordItem"] = 300;

$lob::barsNeeded["IronpickAxeItem"] = "Iron";
$lob::barsAmountNeeded["IronpickAxeItem"] = 2;
$lob::smithingLevelNeeded["IronpickAxeItem"] = 5;
$lob::smithingAnimationTime["IronpickAxeItem"] = 3000;
$lob::chatMessageName["IronpickAxeItem"] = "Iron Pickaxe";
$lob::smithingExp["IronPickaxeItem"] = 250;

$lob::barsNeeded["IronAxeItem"] = "Iron";
$lob::barsAmountNeeded["IronAxeItem"] = 2;
$lob::smithingLevelNeeded["IronAxeItem"] = 5;
$lob::smithingAnimationTime["IronAxeItem"] = 3000;
$lob::chatMessageName["IronAxeItem"] = "Iron Axe";
$lob::smithingExp["IronAxeItem"] = 250;

$lob::barsNeeded["ironBowItem"] = "iron";
$lob::barsAmountNeeded["ironBowItem"] = 5;
$lob::smithingLevelNeeded["ironBowItem"] = 5;
$lob::smithingAnimationTime["ironBowItem"] = 3000;
$lob::chatMessageName["ironBowItem"] = "Iron Bow";
$lob::smithingExp["ironBowItem"] = 400;

$lob::barsNeeded["ironJavlinItem"] = "iron";
$lob::barsAmountNeeded["ironJavlinItem"] = 9;
$lob::smithingLevelNeeded["ironJavlinItem"] = 5;
$lob::smithingAnimationTime["ironJavlinItem"] = 3000;
$lob::chatMessageName["ironJavlinItem"] = "Iron Bow";
$lob::smithingExp["ironBowItem"] = 550;

//steel
$lob::barsNeeded["SteelShortSwordItem"] = "Steel";
$lob::barsAmountNeeded["SteelShortSwordItem"] = 4;
$lob::smithingLevelNeeded["SteelShortSwordItem"] = 15;
$lob::smithingAnimationTime["SteelShortSwordItem"] = 10000;
$lob::chatMessageName["SteelShortSwordItem"] = "Steel Short Sword";
$lob::smithingExp["SteelShortSwordItem"] = 500;

$lob::barsNeeded["SteelpickAxeItem"] = "Steel";
$lob::barsAmountNeeded["SteelpickAxeItem"] = 2;
$lob::smithingLevelNeeded["SteelpickAxeItem"] = 10;
$lob::smithingAnimationTime["SteelpickAxeItem"] = 5000;
$lob::chatMessageName["SteelpickAxeItem"] = "Steel Pickaxe";
$lob::smithingExp["SteelPickaxeItem"] = 450;

$lob::barsNeeded["SteelAxeItem"] = "Steel";
$lob::barsAmountNeeded["SteelAxeItem"] = 2;
$lob::smithingLevelNeeded["SteelAxeItem"] = 10;
$lob::smithingAnimationTime["SteelAxeItem"] = 5000;
$lob::chatMessageName["SteelAxeItem"] = "Steel Axe";
$lob::smithingExp["SteelAxeItem"] = 450;

$lob::barsNeeded["SteelBowItem"] = "Steel";
$lob::barsAmountNeeded["SteelBowItem"] = 5;
$lob::smithingLevelNeeded["SteelBowItem"] = 15;
$lob::smithingAnimationTime["SteelBowItem"] = 15000;
$lob::chatMessageName["SteelBowItem"] = "Steel Bow";
$lob::smithingExp["SteelBowItem"] = 600;

$lob::barsNeeded["SteelJavlinItem"] = "Steel";
$lob::barsAmountNeeded["SteelJavlinItem"] = 9;
$lob::smithingLevelNeeded["SteelJavlinItem"] = 15;
$lob::smithingAnimationTime["SteelJavlinItem"] = 15000;
$lob::chatMessageName["SteelJavlinItem"] = "Steel Javlin";
$lob::smithingExp["SteelJavlinItem"] = 700;

//mithril
$lob::barsNeeded["MithrilShortSwordItem"] = "Mithril";
$lob::barsAmountNeeded["MithrilShortSwordItem"] = 4;
$lob::smithingLevelNeeded["MithrilShortSwordItem"] = 35;
$lob::smithingAnimationTime["MithrilShortSwordItem"] = 16000;
$lob::chatMessageName["MithrilShortSwordItem"] = "Mithril Short Sword";
$lob::smithingExp["MithrilShortSwordItem"] = 1300;

$lob::barsNeeded["MithrilpickAxeItem"] = "Mithril";
$lob::barsAmountNeeded["MithrilpickAxeItem"] = 2;
$lob::smithingLevelNeeded["MithrilpickAxeItem"] = 30;
$lob::smithingAnimationTime["MithrilpickAxeItem"] = 10000;
$lob::chatMessageName["MithrilpickAxeItem"] = "Mithril Pickaxe";
$lob::smithingExp["MithrilPickaxeItem"] = 800;

$lob::barsNeeded["MithrilAxeItem"] = "Mithril";
$lob::barsAmountNeeded["MithrilAxeItem"] = 2;
$lob::smithingLevelNeeded["MithrilAxeItem"] = 30;
$lob::smithingAnimationTime["MithrilAxeItem"] = 10000;
$lob::chatMessageName["MithrilAxeItem"] = "Mithril Axe";
$lob::smithingExp["MithrilAxeItem"] = 800;

$lob::barsNeeded["MithrilBowItem"] = "Mithril";
$lob::barsAmountNeeded["MithrilBowItem"] = 5;
$lob::smithingLevelNeeded["MithrilBowItem"] = 45;
$lob::smithingAnimationTime["MithrilBowItem"] = 15000;
$lob::chatMessageName["MithrilBowItem"] = "Mithril Bow";
$lob::smithingExp["MithrilBowItem"] = 1700;

$lob::barsNeeded["MithrilJavlinItem"] = "Mithril";
$lob::barsAmountNeeded["MithrilJavlinItem"] = 9;
$lob::smithingLevelNeeded["MithrilJavlinItem"] = 45;
$lob::smithingAnimationTime["MithrilJavlinItem"] = 15000;
$lob::chatMessageName["MithrilJavlinItem"] = "Mithril Javlin";
$lob::smithingExp["MithrilJavlinItem"] = 1800;

//Adamantite
$lob::barsNeeded["AdamantiteShortSwordItem"] = "Adamantite";
$lob::barsAmountNeeded["AdamantiteShortSwordItem"] = 4;
$lob::smithingLevelNeeded["AdamantiteShortSwordItem"] = 55;
$lob::smithingAnimationTime["AdamantiteShortSwordItem"] = 24000;
$lob::chatMessageName["AdamantiteShortSwordItem"] = "Adamantite Short Sword";
$lob::smithingExp["AdamantiteShortSwordItem"] = 1300;

$lob::barsNeeded["AdamantitepickAxeItem"] = "Adamantite";
$lob::barsAmountNeeded["AdamantitepickAxeItem"] = 2;
$lob::smithingLevelNeeded["AdamantitepickAxeItem"] = 45;
$lob::smithingAnimationTime["AdamantitepickAxeItem"] = 16000;
$lob::chatMessageName["AdamantitepickAxeItem"] = "Adamantite Pickaxe";
$lob::smithingExp["AdamantitePickaxeItem"] = 900;

$lob::barsNeeded["AdamantiteAxeItem"] = "Adamantite";
$lob::barsAmountNeeded["AdamantiteAxeItem"] = 2;
$lob::smithingLevelNeeded["AdamantiteAxeItem"] = 45;
$lob::smithingAnimationTime["AdamantiteAxeItem"] = 16000;
$lob::chatMessageName["AdamantiteAxeItem"] = "Adamantite Axe";
$lob::smithingExp["AdamantiteAxeItem"] = 900;

$lob::barsNeeded["AdamantiteBowItem"] = "Adamantite";
$lob::barsAmountNeeded["AdamantiteBowItem"] = 5;
$lob::smithingLevelNeeded["AdamantiteBowItem"] = 55;
$lob::smithingAnimationTime["AdamantiteBowItem"] = 30000;
$lob::chatMessageName["AdamantiteBowItem"] = "Adamantite Bow";
$lob::smithingExp["AdamantiteBowItem"] = 2400;

$lob::barsNeeded["AdamantiteJavlinItem"] = "Adamantite";
$lob::barsAmountNeeded["AdamantiteJavlinItem"] = 9;
$lob::smithingLevelNeeded["AdamantiteJavlinItem"] = 55;
$lob::smithingAnimationTime["AdamantiteJavlinItem"] = 30000;
$lob::chatMessageName["AdamantiteJavlinItem"] = "Adamantite Javlin";
$lob::smithingExp["AdamantiteJavlinItem"] = 2500;

//item = bronze short sword
//item = iron axe
//etc
function serverCmdSmithItem(%client,%item)
{
	%itemSquish = convertToItemName(%item);
	%bar = getWord(%item,0) @ "bars";
	%db = $lob::itemDatablock[%itemSquish];

	if(%db $= "" || !isObject(%client.anvilBrick))
		return 0;
		
	//check vector dist
	if(vectorDist(%client.player.position,%client.anvilBrick.position) >= 7)
		return 0;
	
	if(%client.isSmithing)
		return 0;

	if($lob::barsNeeded[%db] $= "")
		return 0;

	if(%client.slo.smithingLevel < $lob::smithingLevelNeeded[%db])
	{
		%m = setkeywords("\c6You need a smithing level of " @ $lob::smithingLevelNeeded[%db] @" to smith a(n) " @ %item, $lob::smithingLevelNeeded[%db] SPC %item,"\c6");
		smartMessage(%client,%m,2000);
		return 0;
	}

	if(%client.slo.inventory.itemCount[%bar] $= "" || $lob::barsNeeded[%db] > %client.slo.inventory.itemCount[%bar])
	{
		%m = setKeyWords("\c6You need atleast " @ $lob::barsAmountNeeded[%db] SPC %metalType @ " Bars to smith a(n) " @ %item@".",$lob::barsAmountNeeded[%db] SPC %item,"\c6");
		smartMessage(%client,%m,1000);
		return 0;
	}
	
	%slo = %client.slo;
	
	if(%client.slo.inventory.itemCount[%bar] >= $lob::barsAmountNeeded[%db])
	{
		//play animation
		//time depends on level of item being smithed
		%client.isSmithing = true;
		%client.doSmithingAnimation(%bar,%db);
		
	}
}

function gameConnection::doSmithingAnimation(%client,%bar,%db)
{
	commandToClient(%client,'closeSmithingGUI');
	%pos = %client.player.position;
	%client.controlToCamera("Point",%pos);
	%client.buildmode = true;
	%client.player.updateArm(hammerimage);
	%client.player.mountImage(hammerimage,0);
	
	%animationTime = $lob::smithingAnimationTime[%db];
	
	%client.setStatus("Smithing",%animationTime + 1000);
	
	%client.player.playThread(0,"ArmAttack");
	%client.player.schedule(%animationTime,playThread,0,"root");
	%client.schedule(%animationTime,stopSmithingAnimation,%bar,%db);
}

function gameConnection::stopSmithingAnimation(%client,%bar,%db)
{
	%client.endOrbit();
	serverCmdUnuseTool(%client);
	%client.player.unmountImage(0);
	
	%slo = %client.slo;
	//%bar = strReplace(strLwr(%barType),"bar","");
	
	if(%client.slo.inventory.itemCount[%bar] >= $lob::barsAmountNeeded[%db])
	{
		commandToClient(%client,'openSmithingGUI');
		%rem = strReplace(strLwr(%bar),"bars","");
		%client.removeFromInventory(%rem SPC "bars", $lob::barsAmountNeeded[%db]);
		%give = strReplace(strLwr(%db),"item","");
		%client.addToInventory($lob::itemCorrectName[%give], 1);
		smartMessage(%client,"\c6Congratulations, you've smithed an " @ $lob::chatMessageName[%db],2000);
		giveExp(%client,"Smithing",$lob::smithingExp[%db]);
	}
	%client.buildmode = "";
	%client.isSmithing = false;
}

function serverCmdPopulateSmithingList(%client)
{
	%lci=-1;
	%l["items",%lci++] = "Short_Sword";
	%l["items",%lci++] = "Axe";
	%l["items",%lci++] = "PickAxe";
	%l["items",%lci++] = "Bow";
	%l["items",%lci++] = "Javlin";
	
	%lcm=-1;
	%l["metals",%lcm++] = "Bronze";
	%l["metals",%lcm++] = "Iron";
	%l["metals",%lcm++] = "Steel";
	%l["metals",%lcm++] = "Mithril";
	%l["metals",%lcm++] = "Adamantite";
	
	for(%i=0;%i<%lci+1;%i++)
		%l1 = trim(%l1 SPC %l["items",%i]);
	for(%i=0;%i<%lcm+1;%i++)
		%l2 = trim(%l2 SPC %l["metals",%i]);
		
	commandToClient(%client,'populateItemsList',%l1);
	commandToClient(%client,'populateMetalsList',%l2);
	
	%i=-1;while(true)
	{	
		%field = %client.slo.inventory.getTaggedField(%i++);
		%fieldL = strLwr(%field);
		if(%field $= "")
			break;
		if(strStr(%fieldl,"bars") >= 0)
		{
			%count = getField(%field,1);
			%name = strReplace(%fieldl,"itemcount","");
			%name = getField(%name,0);
			%name = strReplace(strLwr(%name),"bars","");
			%name = trim(%name);
			%name = strUpr(getSubStr(%name,0,1)) @ getSubStr(%name,1,strLen(%name)-1);
			//lob_msgadmins(%name);
			%finalname = %name @ "_Bars_(" @ %count @ ")";
			%b = trim(%b SPC %finalname);
		}
	}
	
	if(%b $= "")
		%b = -1;
	
	commandToClient(%client,'populateYourBarsList',%b);
}

function serverCmdgetSmithingBodyInfo(%client,%item)
{
	%item = strReplace(%item," ","") @ "item";
	commandToClient(%client,'SmithingBodySetInfo',"Bars needed: " @ $lob::barsAmountNeeded[%item]);
}